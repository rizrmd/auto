import{b as k,r as l,j as e,A as w,f as P,g as L,B as p,D as N,T as h,U as M}from"./index-Bte2K8I5.js";import{S as o}from"./StatsCard-upgvz-zD.js";import{T as O,L as G,A as c,R as E,P as I}from"./AnalyticsChart-NLjDytiG.js";import{D as J}from"./download-efAXHsgS.js";import{R as $}from"./refresh-cw-BLVaXt3C.js";import"./LineChart-mQfQLaH0.js";const U=[{label:"Last 7 days",days:7},{label:"Last 30 days",days:30},{label:"Last 90 days",days:90},{label:"Last 12 months",days:365}];function K(){const{apiCall:d}=k(),[r,D]=l.useState("overview"),[n,m]=l.useState(()=>{const s=new Date,a=new Date;return a.setDate(a.getDate()-30),{startDate:a.toISOString().split("T")[0],endDate:s.toISOString().split("T")[0]}}),[t,T]=l.useState(null),[F,S]=l.useState([]),[x,v]=l.useState(!0),[u,g]=l.useState(null);l.useEffect(()=>{b()},[n,r]);const b=async()=>{try{v(!0),g(null);const s=new URLSearchParams({startDate:n.startDate,endDate:n.endDate,groupBy:r==="overview"?"day":"week"}),[a,i]=await Promise.all([d(`/analytics/global?${s.toString()}`),d(`/analytics/leaderboard?${s.toString()}`).catch(()=>null)]);a?.success&&T(a.data),i?.success&&S(i.data.items||[])}catch(s){g("Failed to load analytics data"),console.error("Analytics loading error:",s)}finally{v(!1)}},R=s=>{const a=new Date,i=new Date;i.setDate(i.getDate()-s),m({startDate:i.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0]})},C=async()=>{try{const s=await d("/analytics/export",{method:"POST",body:JSON.stringify({dateRange:n,type:r})});s.success&&s.data.downloadUrl&&window.open(s.data.downloadUrl,"_blank")}catch(s){console.error("Export error:",s),alert("Failed to export analytics")}},j=[{name:"Jan",tenants:12,leads:89,sales:23,revenue:125e3},{name:"Feb",tenants:15,leads:102,sales:31,revenue:156e3},{name:"Mar",tenants:18,leads:124,sales:28,revenue:142e3},{name:"Apr",tenants:22,leads:145,sales:35,revenue:178e3},{name:"May",tenants:25,leads:167,sales:42,revenue:215e3},{name:"Jun",tenants:28,leads:189,sales:38,revenue:198e3}],A=[{name:"Jan",revenue:125e3,growth:8.5},{name:"Feb",revenue:156e3,growth:12.3},{name:"Mar",revenue:142e3,growth:6.2},{name:"Apr",revenue:178e3,growth:15.8},{name:"May",revenue:215e3,growth:18.4},{name:"Jun",revenue:198e3,growth:11.2}],y=[{name:"WhatsApp",value:45},{name:"Website",value:28},{name:"Direct",value:15},{name:"Social Media",value:8},{name:"Referral",value:4}],f=[{name:"Jan",conversion:3.2,response:45},{name:"Feb",conversion:3.8,response:42},{name:"Mar",conversion:3.5,response:38},{name:"Apr",conversion:4.2,response:35},{name:"May",conversion:4.8,response:32},{name:"Jun",conversion:4.5,response:30}];return x&&!t?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-slate-700 rounded w-48 mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-xl p-6",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-700 rounded-lg mb-4"}),e.jsx("div",{className:"w-24 h-4 bg-slate-700 rounded mb-2"}),e.jsx("div",{className:"w-16 h-8 bg-slate-700 rounded"})]},s))})]})}):u?e.jsx("div",{className:"bg-red-900/20 border border-red-800/50 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:"text-red-400",children:u})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Analytics"}),e.jsx("p",{className:"text-slate-400",children:"Global insights and performance metrics"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:C,className:"px-4 py-2 text-slate-300 hover:text-white hover:bg-slate-700 rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]}),e.jsxs("button",{onClick:b,disabled:x,className:"px-4 py-2 text-slate-300 hover:text-white hover:bg-slate-700 rounded-lg transition-colors flex items-center space-x-2 disabled:opacity-50",children:[e.jsx($,{className:`w-4 h-4 ${x?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]})]})]}),e.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-xl p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-slate-300 text-sm",children:"Date Range:"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[U.map(s=>e.jsx("button",{onClick:()=>R(s.days),className:"px-3 py-1 text-sm rounded-lg transition-colors",style:{backgroundColor:n.startDate===new Date(Date.now()-s.days*24*60*60*1e3).toISOString().split("T")[0]?"#3b82f6":"#374151",color:n.startDate===new Date(Date.now()-s.days*24*60*60*1e3).toISOString().split("T")[0]?"#ffffff":"#d1d5db"},children:s.label},s.label)),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("input",{type:"date",value:n.startDate,onChange:s=>m(a=>({...a,startDate:s.target.value})),className:"px-3 py-1 text-sm bg-slate-700 border border-slate-600 rounded-lg text-white"}),e.jsx("span",{className:"text-slate-400",children:"to"}),e.jsx("input",{type:"date",value:n.endDate,onChange:s=>m(a=>({...a,endDate:s.target.value})),className:"px-3 py-1 text-sm bg-slate-700 border border-slate-600 rounded-lg text-white"})]})]})]})}),e.jsx("div",{className:"flex border-b border-slate-700",children:[{id:"overview",label:"Overview",icon:L},{id:"tenants",label:"Tenants",icon:p},{id:"revenue",label:"Revenue",icon:N},{id:"performance",label:"Performance",icon:h}].map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>D(s.id),className:`
                flex items-center space-x-2 px-6 py-3 text-sm font-medium transition-colors
                ${r===s.id?"text-blue-400 border-b-2 border-blue-400 bg-slate-700/50":"text-slate-400 hover:text-white hover:bg-slate-700/30"}
              `,children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.id)})}),r==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(o,{title:"Total Tenants",value:t?.overview.totalTenants||0,icon:p,trend:{value:t?.growth.tenantGrowthRate||0,period:"vs last period"},color:"blue"}),e.jsx(o,{title:"Total Leads",value:t?.overview.totalLeads||0,icon:M,trend:{value:t?.growth.leadGrowthRate||0,period:"vs last period"},color:"purple"}),e.jsx(o,{title:"Cars Sold",value:t?.overview.soldCars||0,icon:h,trend:{value:t?.growth.salesGrowthRate||0,period:"vs last period"},color:"green"}),e.jsx(o,{title:"Conversion Rate",value:`${t?.performance.leadConversionRate||0}%`,icon:w,description:"Avg. across all tenants",color:"yellow"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(O,{data:t?.trends||j}),e.jsx(G,{data:y})]})]}),r==="tenants"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(c,{type:"bar",title:"Top Performing Tenants",subtitle:"By lead conversion rate",data:t?.performance.topPerformingTenants.map(s=>({name:s.name,conversion:s.conversionRate,leads:s.leadsCount}))||[],series:[{key:"conversion",name:"Conversion Rate %",color:"#10b981"},{key:"leads",name:"Total Leads",color:"#3b82f6"}],height:300}),e.jsx(c,{type:"line",title:"New Tenant Acquisition",subtitle:"Monthly new tenant registrations",data:t?.trends||j,series:[{key:"tenants",name:"New Tenants",color:"#8b5cf6"}],height:300})]}),e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Top Tenants by Performance"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-400 text-sm",children:[e.jsx("th",{className:"pb-3 font-medium",children:"Tenant"}),e.jsx("th",{className:"pb-3 font-medium",children:"Leads"}),e.jsx("th",{className:"pb-3 font-medium",children:"Conversion"}),e.jsx("th",{className:"pb-3 font-medium",children:"Score"})]})}),e.jsx("tbody",{className:"text-white",children:t?.performance.topPerformingTenants.map(s=>e.jsxs("tr",{className:"border-t border-slate-700",children:[e.jsx("td",{className:"py-3",children:s.name}),e.jsx("td",{className:"py-3",children:s.leadsCount}),e.jsxs("td",{className:"py-3",children:[s.conversionRate,"%"]}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:"px-2 py-1 bg-green-400/20 text-green-400 rounded-lg text-sm",children:s.score})})]},s.id))||e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-8 text-center text-slate-400",children:"No tenant data available"})})})]})})]})]}),r==="revenue"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(E,{data:A}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(o,{title:"Total Revenue",value:"$1.14M",icon:N,trend:{value:15.8,period:"vs last period"},color:"green"}),e.jsx(o,{title:"Avg. Revenue/Tenant",value:"$40,714",icon:p,description:"Per month average",color:"blue"}),e.jsx(o,{title:"Revenue Growth",value:"18.4%",icon:h,description:"Month over month",color:"purple"})]})]}),r==="performance"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{data:f}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(c,{type:"area",title:"Lead Sources Performance",subtitle:"Conversion rates by source",data:y,series:[{key:"value",name:"Leads",color:"#06b6d4"}],height:250}),e.jsx(c,{type:"bar",title:"Response Time Trends",subtitle:"Average response time in minutes",data:f,series:[{key:"response",name:"Response Time",color:"#f97316"}],height:250})]})]})]})}export{K as AnalyticsPage};
